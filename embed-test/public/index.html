<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ozwell Dashboard - Embed Test</title>
  <link rel="stylesheet" href="/assets/styles.css" />
  <link rel="stylesheet" href="/assets/chat-wrapper.css" />
  <!-- iframe-sync library for state synchronization -->
  <script src="/assets/iframe-sync.js"></script>
</head>

<body>
  <!-- Header Section -->
  <header class="header">
    <div class="header-left">
      <div class="avatar">A</div>
      <div class="header-info">
        <h1>Welcome back, Alice Johnson!</h1>
        <div class="header-meta">
          <span>Administrator</span>
          <span>‚Ä¢</span>
          <span>Last login: Today at 2:45 PM</span>
        </div>
      </div>
    </div>
    <div class="status-badge">
      <span class="status-dot"></span>
      Active
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-grid">
      <!-- Left Column: Dashboard Overview -->
      <section class="dashboard-container">
        <h2 class="section-header">
          <span class="section-icon">üìä</span>
          Dashboard Overview
        </h2>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Name</div>
            <div class="stat-value" id="dashboard-name">Alice Johnson</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">Address</div>
            <div class="stat-value" id="dashboard-address">123 Main Street, Suite 100</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">Zip Code</div>
            <div class="stat-value" id="dashboard-zip">90210</div>
          </div>
        </div>

        <!-- Recent Activity -->
        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; margin-top: 24px;">Recent Activity</h3>
        <div class="activity-list">
          <div class="activity-item">
            <div class="activity-icon">üìù</div>
            <div class="activity-content">
              <div class="activity-title">Updated project requirements</div>
              <div class="activity-time">15 minutes ago</div>
            </div>
          </div>

          <div class="activity-item">
            <div class="activity-icon">üë•</div>
            <div class="activity-content">
              <div class="activity-title">Team meeting scheduled</div>
              <div class="activity-time">1 hour ago</div>
            </div>
          </div>

          <div class="activity-item">
            <div class="activity-icon">üìä</div>
            <div class="activity-content">
              <div class="activity-title">Monthly report generated</div>
              <div class="activity-time">3 hours ago</div>
            </div>
          </div>

          <div class="activity-item">
            <div class="activity-icon">üîß</div>
            <div class="activity-content">
              <div class="activity-title">System maintenance completed</div>
              <div class="activity-time">Yesterday</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Right Column: Form Input Section -->
      <section class="form-container">
        <h2 class="section-header">
          <span class="section-icon">‚úèÔ∏è</span>
          User Information
        </h2>

        <form id="user-form" class="form-vertical">
          <div class="form-field">
            <label for="input-name">Name</label>
            <input type="text" id="input-name" name="name" placeholder="Enter your name" value="Alice Johnson" />
          </div>

          <div class="form-field">
            <label for="input-address">Address</label>
            <input type="text" id="input-address" name="address" placeholder="Enter your address"
              value="123 Main Street, Suite 100" />
          </div>

          <div class="form-field">
            <label for="input-zip">Zip Code</label>
            <input type="text" id="input-zip" name="zip" placeholder="Enter zip code" value="90210" />
          </div>

          <button type="submit" class="submit-button">Update Dashboard</button>
        </form>
      </section>
    </div>
  </main>

  <!-- Chat Floating Button -->
  <button id="ozwell-chat-button" class="ozwell-chat-button">
    üí¨
  </button>

  <!-- Chat Window Wrapper -->
  <div id="ozwell-chat-wrapper" class="ozwell-chat-wrapper hidden">
    <div class="ozwell-chat-header">
      <div class="ozwell-chat-title">
        üí¨ Ozwell
      </div>
      <div class="ozwell-chat-controls">
        <button id="ozwell-minimize-btn" class="ozwell-chat-control-btn" title="Minimize">‚àí</button>
        <button id="ozwell-close-btn" class="ozwell-chat-control-btn" title="Close">√ó</button>
      </div>
    </div>
    <div class="ozwell-chat-content" id="chat-container"></div>
  </div>

  <script>
    // Simple form submission handler for Checkpoint 1
    document.getElementById('user-form').addEventListener('submit', function (e) {
      e.preventDefault();

      // Get form values
      const name = document.getElementById('input-name').value;
      const address = document.getElementById('input-address').value;
      const zip = document.getElementById('input-zip').value;

      // Update dashboard
      document.getElementById('dashboard-name').textContent = name;
      document.getElementById('dashboard-address').textContent = address;
      document.getElementById('dashboard-zip').textContent = zip;
    });

    // Load Ozwell chat widget script
    const referenceBaseUrl = '__REFERENCE_BASE_URL__';
    const normalizedBase = referenceBaseUrl.replace(/\/$/, '');

    window.OzwellChatConfig = {
      containerId: 'chat-container',
      title: 'Ozwell Assistant',
      placeholder: 'Ask me anything...',
      model: 'llama3.1:8b',
      endpoint: `${normalizedBase}/embed/chat`,  // Routes through reference server to Ollama
      widgetUrl: `${normalizedBase}/embed/widget.html`,
      // MCP Tools - defined by parent page
      tools: [
        {
          name: 'update_name',
          description: 'Updates the user\'s name field to a new value. Use when user requests to change/update/modify their name.',
          parameters: {
            type: 'object',
            properties: {
              name: {
                type: 'string',
                description: 'The new name value'
              }
            },
            required: ['name']
          }
        }
      ]
    };

    const loader = document.createElement('script');
    loader.src = `${normalizedBase}/embed/embed.js`;
    loader.async = true;
    document.head.appendChild(loader);
  </script>

  <!-- Chat wrapper functionality -->
  <script src="/assets/chat-wrapper.js"></script>

  <!-- State management with iframe-sync -->
  <script src="/assets/app.js"></script>
</body>

</html>
